var carga_RLC_str = '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg   xmlns:dc="http://purl.org/dc/elements/1.1/"   xmlns:cc="http://creativecommons.org/ns#"   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"   xmlns:svg="http://www.w3.org/2000/svg"   xmlns="http://www.w3.org/2000/svg"   id="svgrlc"   version="1.1"   viewBox="0 0 51.391415 86.428841"   height="86.428841mm"   width="51.391415mm">  <defs     id="defs2" />  <metadata     id="metadata5">    <rdf:RDF>      <cc:Work         rdf:about="">        <dc:format>image/svg+xml</dc:format>        <dc:type           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />        <dc:title></dc:title>      </cc:Work>    </rdf:RDF>  </metadata>  <g     transform="translate(-20.016316,-95.083925)"     id="layer1">    <g       id="g958">      <g         id="g3326"         transform="matrix(0,-0.25060856,0.27207464,0,-16.590339,205.35113)">        <path           d="m 301.21812,172.91 c 4.76257,-0.5934 3.5968,-10.78979 3.5968,-20.67226 0,-9.88247 -4.17489,-15.72719 -8.34405,-15.72719 -4.16917,0 -11.50889,7.62494 -11.50889,17.50741 -13.97276,0 -13.97276,-0.27186 -13.97276,-0.27186"           id="path3270"           style="fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#080612;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:0.88757396" />        <path           d="m 300.56068,172.93485 c -4.36697,-3.16484 -4.1902,-8.61398 -4.58581,-18.69425 -0.38754,-9.87487 8.52654,-18.29862 12.69571,-18.29862 4.16916,0 11.50889,6.24033 12.10229,17.30961 0,9.88247 0.37456,17.90303 -4.38801,19.88105"           id="path3279"           style="fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#080612;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:0.88757396" />        <path           d="m 315.79412,172.73705 c -4.36697,-3.16484 -4.1902,-8.61398 -4.58581,-18.69425 -0.38754,-9.87487 8.52654,-18.29862 12.69571,-18.29862 4.16916,0 11.50889,6.24033 12.10229,17.30961 0,9.88247 0.37456,17.90303 -4.38801,19.88105"           id="path3283"           style="fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#080612;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:0.88757396" />        <path           d="m 331.2227,172.73705 c -4.36697,-3.16484 -4.1902,-8.61398 -4.58581,-18.69425 -0.38754,-9.87487 8.52654,-18.29862 12.69571,-18.29862 4.16916,0 11.50889,6.24033 12.10229,17.30961 0,9.88247 0.37456,17.90303 -4.38801,19.88105"           id="path3285"           style="fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#080612;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:0.88757396" />        <path           d="m 346.05788,172.53925 c -4.36697,-3.16484 -4.1902,-8.61398 -4.58581,-18.69425 -0.38754,-9.87487 8.52654,-18.29863 12.69571,-18.29863 4.16916,0 11.50889,6.24034 12.10229,17.30962 h 12.12583"           id="path3287"           style="fill:none;fill-opacity:1;fill-rule:nonzero;stroke:#080612;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:0.88757396" />      </g>      <g         id="g877"         transform="translate(0.52916667)">        <path           d="m 46.061856,106.62842 c 0,15.73945 0,15.73945 0,15.73945 v 0"           id="path3414"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:0.62962085;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />        <path           d="m 46.055318,124.45281 c 0,16.0742 0,16.0742 0,16.0742 v 0"           id="path3416"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:0.62962097;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />        <path           d="m 50.19534,122.55805 c -7.781889,0 -7.781889,0 -7.781889,0 v 0"           id="path3418"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:0.62962103;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />        <path           d="m 50.171722,124.2447 c -7.781889,0 -7.781889,0 -7.781889,0 v 0"           id="path3420"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:0.62962103;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />      </g>      <g         id="g3409"         transform="matrix(0.35836065,0,0,0.28255496,-88.455025,42.880269)">        <path           d="m 437.5107,217.57773 c 0,44.70334 0.14835,41.4396 0.14835,41.4396"           id="path3385"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" />        <path           d="m 437.01437,291.8484 c 0,44.70333 0,44.70333 0,44.70333 v 0"           id="path3403"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" />        <path           d="m 436.6752,292.42333 6.78544,-3.78297 -12.02866,-3.75312 12.3564,-7.35337 -11.58894,-4.3126 10.74449,-6.00869 -11.12821,-4.3126 c 0,0 4.54995,-3.48044 6.23144,-4.54168"           id="path3401"           style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" />      </g>      <g         id="g904"         transform="translate(1.8708867,-2.9399648)">        <g           transform="matrix(0.26458333,0,0,0.26458333,-76.271557,3.0143673)"           id="g4710">          <path             style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"             id="path3304"             d="m 456.63463,586.95891 c 0,44.70333 0,44.70333 0,44.70333 v 0" />          <path             style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"             id="path3306"             d="m 478.66504,632.0064 c -44.70334,0 -44.70334,0 -44.70334,0 v 0" />          <path             style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1.99999964;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"             id="path3308"             d="m 469.89694,641.06336 c -27.24629,0 -27.24629,0 -27.24629,0 v 0" />          <path             style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2.00000024;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"             id="path3312"             d="m 463.83269,649.03374 c -14.60724,0 -14.60724,0 -14.60724,0 v 0" />        </g>        <text           y="184.37521"           x="37.04409"           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.17499995px;line-height:0%;font-family:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"           space="preserve"           id="text3361">          <tspan             y="184.37521"             x="37.04409"             style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.3499999px;line-height:100%;font-family:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;stroke-width:0.26458332px"             id="tspan3363">GND</tspan>        </text>      </g>      <path         style="fill:none;stroke:#000000;stroke-width:0.60500002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"         d="m 25.240076,137.43891 v 14.16646 h 42.913653 v -13.63074"         id="path906" />      <path         style="fill:none;stroke:#000000;stroke-width:0.465;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"         d="m 46.41724,155.37394 v 0 -4.3031"         id="path908" />      <path         style="fill:none;stroke:#000000;stroke-width:0.565;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"         d="m 46.584483,140.52701 v 11.34563"         id="path910" />      <path         style="fill:none;stroke:#000000;stroke-width:0.66500002;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"         d="M 24.997899,110.52188 24.845712,95.416425 H 68.42754 l -0.09595,8.941515"         id="path906-7" />      <path         style="fill:none;stroke:#000000;stroke-width:0.56500006;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"         d="M 46.591023,106.62842 V 95.28279"         id="path910-3" />    </g>  </g></svg>';


// El simbolo del contactor fue tomado de https://symbols.radicasoftware.com/stencil/JIC.html



// rutina principal que se ejecuta cuando se termina de cargar el HTML Doc
SVG.on(document, 'DOMContentLoaded', function() {

// se crea el documento svg
  var draw = SVG('drawing').size('100%', '100%');

// se dibujan los 3 inversores
  var ib = PutInverter('Biomasa', 50, 50, draw);
  var iph = PutInverter('Solar', 500, 50, draw);
  var id = PutInverter('Diesel', 50, 300, draw);

// se dibujan los 4 contactores
  var ctb = PutContactor(180, 80, draw, "cbio");
  var ctph = PutContactor(400, 80, draw, "csolar");
  var ctd = PutContactor(180, 330, draw, "cdi");


  // se dibujan las conexiones
  var n_ib_cb = draw.line(150, 100, 170, 100).stroke('#000000'); // desde inv. bio hasta contactor
  var n_cb_cs = draw.line(255, 100, 390, 100).stroke('#000000'); // desde contactor bio a contactor solar
  var n_cs_is = draw.line(475, 100, 500, 100).stroke('#000000'); // desde contactor solar a inv solar
  var n_id_cd = draw.line(150, 350, 170, 350).stroke('#000000'); // desde inv diesel a contactor diesel

  // desde contactor diesel a los contactores solar y Biomasa
  var n_cd_1 = draw.line(300, 350, 300, 100).stroke('#000000');
  var n_cd_2 = draw.line(255, 350, 300, 350).stroke('#000000');

  // dibujo de la carga
  var n_r1 = draw.line(300, 230, 500, 230).stroke('#000000');
  var n_r2 = draw.line(500, 230, 500, 280).stroke('#000000');

  draw.svg(carga_RLC_str);
  var carga_electrica = SVG.get('svgrlc')
  carga_electrica.move(403, 280).size(190,190);


});



// metodo que dibuja y entrega un contactor de estado solido
// en las coordenadas especificadas
function PutContactor(x, y, draw, nombre){

  var estado = true;

  var sq = draw.rect(13, 40).move(26, 0).fill('#00ff00').stroke('none');
  var rombo = draw.polyline([[5,20], [32.5,-15], [60,20], [32.5, 55], [5,20]]).fill('#ffffff');
  var pin_mas = draw.line(-10, 20, 25, 20);
  var bar_left = draw.line(25, 0, 25, 40);
  var bar_right = draw.line(40, 0, 40, 40);
  var pin_menos = draw.line(40, 20, 75, 20);

  var cg = draw.group();

  cg.add(rombo);
  cg.add(pin_mas);
  cg.add(pin_menos);
  cg.add(bar_right);
  cg.add(bar_left);
  cg.add(sq);

  cg.move(x, y);
  cg.attr({stroke:'#000000'});

  var contactor = {cg, estado, nombre, sq};

// funcion que se ejecuta cada que se
  cg.click(function() {
    if ( estado == true) {
      estado = false;
      sq.fill('#ffffff');
    } else {
      estado = true;
      sq.fill('#00ff88');
    }

    NotifyContactorBD(nombre, estado);// se actualiza en la base de datos

  });

  cg.mouseover(function() {
    this.attr({ stroke: '#f06' });
  });
  cg.mouseout(function() {
    this.attr({ stroke: '#000000' });
  });

  return contactor;
}




// funcion que dibuja un inversor en las coordenadas especificadas
// y retorna su correspondiente grupo svg para posterior manipulacion
function PutInverter(nombre, x, y, draw){

  // de dibuja el inversor en las coordenadas 0 0
    var iv_sq = draw.rect(100, 100).radius(10).attr({fill:'#ffffff'});
    var iv_diag = draw.line(3, 97, 97, 3);
    var iv_DC = draw.text('DC').move(20,20);
    var iv_AC = draw.text('AC').move(65,70);
    var iv_name = draw.text(nombre).move(20, 105);

  // se agrupan cada uno de los elementos geometricos como un grupo llamado ib,
  // se esta forma se pueden manejar todos como uno solo
    var iv = draw.group();
    iv.add(iv_sq);
    iv.add(iv_diag);
    iv.add(iv_DC);
    iv.add(iv_AC);
    iv.add(iv_name);

    iv.attr({stroke:'#000000'});
    iv.move(x, y);

    iv.mouseover(function() {
      this.attr({ stroke: '#f06' });
    });
    iv.mouseout(function() {
      this.attr({ stroke: '#000000' });
    });

    return iv;
}




// metodo que actualiza en la base de datos mongo db el estado de un contactor
function NotifyContactorBD(nombre, estado){

}




// funcion que lee de la base de datos el estado del contactor especificado por nombre
function CheckState(nombre){

}
